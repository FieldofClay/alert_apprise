events {
    worker_connections 1024;
}

http {
    # Custom log format to capture request body
    log_format webhook_format '$time_iso8601 | Method: $request_method | URI: $request_uri | Body: $request_body';
    
    server {
        listen 80;
        server_name _;
        
        # Health check endpoint
        location /health {
            access_log off;
            return 200 "healthy\n";
        }
        
        # Webhook endpoint
        location /webhook {
            access_log /var/log/webhook/access.log webhook_format;
            
            # Return success
            add_header Content-Type text/plain;
            return 200 "Webhook received successfully\n";
        }
        
        # Catch-all for debugging
        location / {
            access_log /var/log/webhook/access.log webhook_format;
            return 200 "OK\n";
        }
    }
}
